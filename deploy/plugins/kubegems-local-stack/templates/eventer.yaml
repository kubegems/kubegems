{{- if .Values.eventer.enabled -}}
# https://github.com/NVIDIA/k8s-device-plugin#deployment-via-helm
apiVersion: plugins.kubegems.io/v1beta1
kind: Plugin
metadata:
  name: kubernetes-event-exporter
  namespace: {{ .Release.Namespace }}
spec:
  kind: helm
  repo: https://charts.bitnami.com/bitnami
  installNamespace: {{ .Values.eventer.namespace }}
  version: 1.4.12
  values:
    image:
      {{ include "common.images.repository" ( dict "registry" "docker.io" "repository" "bitnami/kubernetes-event-exporter" "context" .) }}
    config:
      logLevel: error
      logFormat: json
      route:
        routes:
          - match:
              - receiver: "dump"
      receivers:
        - name: "dump"
          file:
            path: "/dev/stdout"
---
{{- if .Values.logging.enabled -}}
apiVersion: logging.banzaicloud.io/v1beta1
kind: Flow
metadata:
  name: kubegems-eventer-flow
  namespace: {{ .Values.eventer.namespace }}
spec:
  globalOutputRefs:
  - kubegems-container-console-output
  match:
  - select:
      labels:
        app.kubernetes.io/name: kubernetes-event-exporter
{{- end -}}          
{{- end -}}
