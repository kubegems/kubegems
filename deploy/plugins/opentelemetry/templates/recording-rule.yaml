apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  labels:
    prometheusrule.kubegems.io/name: opentelemetry-collector
  name: opentelemetry-collector
  namespace: {{ .Release.Namespace }}
spec:
  groups:
    - name: opentelemetry-collector
      rules:
        - record: gems_otel_calls_total
          expr: |
            sum(label_replace(label_replace(label_replace(calls_total, "namespace", "$1", "k8s_namespace_name", "(.*)"), "service", "$1", "service_name", "(.*)"), "pod", "$1", "k8s_pod_name", "(.*)"))without(k8s_namespace_name, k8s_pod_name, service_name)
        - record: gems_otel_latency_bucket
          expr: |
            sum(label_replace(label_replace(label_replace(latency_bucket, "namespace", "$1", "k8s_namespace_name", "(.*)"), "service", "$1", "service_name", "(.*)"), "pod", "$1", "k8s_pod_name", "(.*)"))without(k8s_namespace_name, k8s_pod_name, service_name)
